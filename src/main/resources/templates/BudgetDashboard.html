    <!DOCTYPE html>
    <html xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="UTF-8">
        <title>Budget Dashboard</title>


        <link rel="stylesheet" th:href="@{/Styles/BudgetDashboardCss.css}">
        <link rel="stylesheet" th:href="@{/Styles/fragmentCSS.css}">
    </head>
    <body>
    <div th:replace="Fragments  :: sidebar(${user})"></div>
    <div th:replace="Fragments  :: navbar"></div>
    <div class="container">

        <h2>Budget Dashboard</h2>

        <!-- User Info + Current Balance -->
        <div class="card">
            <div class="info-row">
                <span class="info-label">Email:</span>
                <span th:text="${user.email}"></span>
            </div>

            <div class="info-row">
                <span class="info-label">Total Budget:</span>
                <span th:text="${budget != null ? budget.total : 0}"></span>
            </div>

            <button class="add-btn" onclick="openModal('addModal')">
                + Add Balance (PayPal)
            </button>
        </div>

        <!-- Transaction Table -->
        <div class="card">
            <h3>Transactions</h3>
            <table>
                <thead>
                <tr>
                    <th>Transaction ID</th>
                    <th>Amount</th>
                    <th>Account</th>
                    <th>Date</th>
                    <th> Transaction Type</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="b : ${transactions}">
                    <td th:text="${b.transactionId}"></td>
                    <td th:text="${b.amount}"></td>
                    <td th:text="${b.accountInfo}"></td>
                    <td th:text="${b.time}"></td>
                    <td th:text="${b.transactionType}"></td>
                </tr>
                </tbody>
            </table>
        </div>

    </div>

    <div class="modal" id="addModal">
        <div class="modal-content">
            <h3>Add Budget Amount</h3>
            <div class="form-box">
                <label for="amount">Amount:</label>
                <input type="text" id="amount" name="amount" placeholder="Enter amount">
            </div>
            <div class="form-box">
                <label for="paypal-email">PayPal Email:</label>
                <input type="email" id="paypal-email" name="paypal-email" placeholder="Enter PayPal email">
            </div>

            <div id="paypal-button-container"></div>
            <p class="powered-by-paypal">Powered by **Sujan**</p>

            <button class="cancel-btn" onclick="closeModal('addModal')">Cancel</button>

        </div>
    </div>

    <!-- SUCCESS Modal -->
    <div class="modal" id="successModal">
        <div class="modal-content">
            <h3>Payment Successful üéâ</h3>
            <p>Your budget has been updated.</p>
            <button class="close-btn" onclick="closeModal('successModal')">Close</button>
        </div>
    </div>

    <!-- CANCEL Modal -->
    <div class="modal" id="cancelModal">
        <div class="modal-content">
            <h3>Payment Cancelled ‚ùå</h3>
            <p>Your transaction was not completed.</p>
            <button class="close-btn" onclick="closeModal('cancelModal')">Close</button>
        </div>
    </div>

    <script>

        function openModal(id) {
    document.getElementById(id).classList.add('show');
}
function closeModal(id) {
    document.getElementById(id).classList.remove('show');
}
    </script>

    <!-- PayPal SDK -->
    <script src="https://www.paypal.com/sdk/js?client-id=AWk_kmV8NezZNKtFvaXrkiQ5ZX-pzN3EXRKrUx9sEgcwnDdvQabHkWINMu39V8OljDZ5GPXdNFRErtRU"></script>
    <script>
        paypal.Buttons({
            createOrder: function(data, actions) {
                return actions.order.create({
                    purchase_units: [{
                        amount: {
                            value: document.getElementById("amount").value
                        }
                    }]
                });
            },

            onApprove: function(data, actions) {
                return actions.order.capture().then(function(details) {

                    openModal("successModal");
                    closeModal("addModal");

                    fetch("/budget/success", {
                        method: "POST",
                        headers: {"Content-Type": "application/json"},
                        body: JSON.stringify({
                            amount: document.getElementById("amount").value,
                            accountInfo: document.getElementById("paypal-email").value,
                            transactionInfo: details.id,
                            transactionType: "CREDIT"
                        })
                    }).then(() => {
                        setTimeout(() => location.reload(), 1000);
                    });
                });
            },

            onCancel: function() {
                openModal("cancelModal");
                closeModal("addModal");
            }
        }).render('#paypal-button-container');
    </script>


    </body>
    </html>
