<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Bids</title>
    <link rel="stylesheet" th:href="@{/Styles/fragmentCSS.css}">
    <link rel="stylesheet" th:href="@{/Styles/BidTableCSS.css}">

</head>
<body>
<!-- Sidebar Fragment -->
<div th:replace="Fragments :: sidebar(${users})" class="sidebar-fragment"></div>

<!-- Navbar Fragment -->
<div th:replace="Fragments :: navbar" class="navbar-fragment"></div>
<div class="bid-table-page">

    <h2 class="page-title">Bids Table</h2>

    <div class="table-wrapper">
        <table class="bid-table">
            <thead>
            <tr>
                <th>ID</th>
                <th>Item Name</th>
                <th>Image</th>
                <th>Buyer</th>
                <th>Seller</th>
                <th>Base Price</th>
                <th>Category</th>
                <th>Bid Amount</th>
                <th>Review</th>
                <th>Description</th>
                <th>Bid Time</th>
                <th>Rate</th>
                <th>Action</th>
            </tr>
            </thead>

            <tbody>
            <tr th:each="bid : ${userBids}" th:class="${bid.winning} ? 'winner-row' : ''">
                <td th:text="${bid.bidId}"></td>
                <td th:text="${bid.item?.itemName ?: 'N/A'}"></td>
                <td>
                    <img class="item-img"
                         th:src="@{/items/{img}(img=${bid.item?.itemImage ?: 'default.png'})}"
                         alt="Item Image">
                </td>
                <td th:text="${bid.user?.username ?: 'Unknown'}"></td>
                <td th:text="${bid.item?.user?.username ?: 'Unknown'}"></td>
                <td th:text="${bid.item?.amount ?: 0}"></td>
                <td th:text="${bid.item?.category?.name ?: 'N/A'}"></td>
                <td th:text="${bid.bidAmount}"></td>
                <td class="desc" th:text="${bid.item?.description ?: ''}"></td>
                <td th:text="${bid.bidTime}"></td>
                <td th:text="${bid.item?.rate ?: 'N/A'}"></td>
                <td th:text="${bid.winning} ? 'Won' : 'Lost'"></td>

                <!-- DELETE ACTION -->
                <td>
                    <a class="delete-btn"
                       th:href="@{/bid/delete/{id}(id=${bid.winning and bid.item?.bidDetails != null ? bid.item.bidDetails.bidDetailsId : bid.bidId})}"
                       onclick="return confirm('Are you sure you want to delete this winning bid?')">
                        Delete
                    </a>
                </td>
            </tr>
            </tbody>
        </table>
    </div>

</div>
<script th:if="${errorMessage != null}">
    alert('[[${errorMessage}]]');
</script>
</body>
</html>